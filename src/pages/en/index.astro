---
import Layout from '../../layouts/Layout.astro';
import ImpactCard from '../../components/ImpactCard.astro';
import TeamMemberCard from '../../components/TeamMemberCard.astro';
import PracticeAreaCard from '../../components/PracticeAreaCard.astro';
import altoImpactoEs from '../../data/altoImpacto.json';
import altoImpactoEn from '../../data/altoImpacto-en.json';
import { getCollection } from 'astro:content';
import { getLangFromUrl, useTranslations, useTranslatedPath } from '../../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const altoImpactoData = lang === 'en' ? altoImpactoEn : altoImpactoEs;

const langPrefix = `${lang}/`;
const allMembers = (await getCollection('team')).filter((m) => m.id.startsWith(langPrefix));
const areasDePractica = (await getCollection('areas'))
	.filter((a) => a.id.startsWith(langPrefix))
	.sort((a, b) => a.data.order - b.data.order);
const teamMembers = allMembers
	.filter((m) => m.data.role !== 'socio')
	.sort((a, b) => a.data.order - b.data.order);

const areaBasePath = lang === 'es' ? '/areas/' : '/en/areas/';
const teamBasePath = lang === 'es' ? '/team/' : '/en/team/';
const stripLangPrefix = (id: string) => id.replace(langPrefix, '');
---

<Layout
	title="Home"
	description="Welcome to Seibel Henriquez website"
	keywords="your, keywords, here"
>
	<!-- Hero Section -->
	<section class="relative h-svh w-full">
		<video class="absolute inset-0 w-full h-full object-cover" autoplay muted loop playsinline>
			<source src="/hero_video.mp4" type="video/mp4" />
		</video>

		<div class="absolute inset-0 bg-black/30"></div>

		<div class="relative z-10 w-full h-full flex flex-col items-center justify-center">
			<h1 id="hero-title" class="text-light-gray text-2xl md:text-3xl lg:text-4xl font-regular text-center uppercase" set:html={t('home.hero.title')} />
			<svg id="hero-line" class="w-full mt-2" viewBox="0 0 1000 4" preserveAspectRatio="none">
				<polyline points="0,2 1000,2" stroke="#8a5f2a" stroke-width="4" fill="none" />
			</svg>

			<div class="absolute bottom-12 px-12 w-full text-light-gray text-xl md:text-2xl font-light flex flex-col md:flex-row items-center justify-between gap-6 text-center md:text-left">
				<p class="text-left! max-w-140">{t('home.hero.subtitle')}</p>
				<div class="flex gap-2">
					<img src="/assets/logos/certificate.png" alt="Certificate" class="h-30 w-auto">
					<img src="/assets/logos/certificate.png" alt="Certificate" class="h-30 w-auto">
					<img src="/assets/logos/certificate.png" alt="Certificate" class="h-30 w-auto">
				</div>
			</div>
		</div>
	</section>

	<!-- Stats Section -->
	<section class="bg-light-gray py-16 md:py-24 px-6 md:px-12 lg:px-20" id="statsSection">
		<div class="max-w-360 mx-auto grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-8 md:gap-12">
			<div class="text-center lg:text-left">
				<h2 class="text-bronze text-4xl md:text-5xl font-regular mb-2">
					+<span class="counter" data-target="1800">0</span>
				</h2>
				<p class="text-dark-slate text-sm md:text-xl font-light">{t('home.stats.casos')}</p>
			</div>
			<div class="text-center lg:text-left">
				<h2 class="text-bronze text-4xl md:text-5xl font-regular mb-2">
					+<span class="counter" data-target="450">0</span>
				</h2>
				<p class="text-dark-slate text-sm md:text-xl font-light">{t('home.stats.clientes')}</p>
			</div>
			<div class="text-center lg:text-left">
				<h2 class="text-bronze text-4xl md:text-5xl font-regular mb-2">
					+<span class="counter" data-target="20">0</span>
				</h2>
				<p class="text-dark-slate text-sm md:text-xl font-light">{t('home.stats.anos')}</p>
			</div>
			<div class="text-center lg:text-left">
				<h2 class="text-bronze text-4xl md:text-5xl font-regular mb-2">
					+<span class="counter" data-target="14">0</span>
				</h2>
				<p class="text-dark-slate text-sm md:text-xl font-light">{t('home.stats.colaboraciones')}</p>
			</div>
		</div>
	</section>

	<script>
		const statsSection = document.getElementById('statsSection');
		const counters = document.querySelectorAll('.counter');
		let hasAnimated = false;

		const animateCounter = (counter: Element) => {
			const target = parseInt(counter.getAttribute('data-target') || '0');
			const duration = 5000;
			const increment = target / (duration / 16);
			let current = 0;

			const updateCounter = () => {
				current += increment;
				if (current < target) {
					counter.textContent = Math.floor(current).toString();
					requestAnimationFrame(updateCounter);
				} else {
					counter.textContent = target.toString();
				}
			};

			updateCounter();
		};

		const observer = new IntersectionObserver((entries) => {
			entries.forEach((entry) => {
				if (entry.isIntersecting && !hasAnimated) {
					hasAnimated = true;
					counters.forEach((counter) => {
						animateCounter(counter);
					});
				}
			});
		}, {
			threshold: 0.5
		});

		if (statsSection) {
			observer.observe(statsSection);
		}
	</script>

	<!-- THE FIRM Section -->
	<section class="bg-light-gray py-16 md:py-24 px-6 md:px-12 lg:px-20">
		<div class="max-w-360 mx-auto grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
			<div>
				<h2 class="text-dark-slate text-3xl md:text-4xl font-light tracking-wide">{t('home.firma.title')}</h2>
				<div class="w-16 h-0.75 bg-bronze mb-8"></div>

				<div class="flex flex-col gap-6">
					<p class="text-dark-slate text-base md:text-2xl leading-tight font-light" set:html={t('home.firma.p1')} />
					<p class="text-dark-slate text-base md:text-2xl leading-tight font-light">
						{t('home.firma.p2')}
					</p>
					<a href={translatePath('/la-firma')} class="border-2 border-bronze text-bronze px-8 py-3 hover:bg-bronze hover:text-white transition-colors duration-300 text-sm md:text-base tracking-wide w-fit">
						{t('home.firma.cta')}
					</a>
				</div>
			</div>
			<div class="flex items-center justify-center">
				<svg id="hero_svg" data-name="Capa 2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 505.05 216.03" class="fill-none stroke-[20px] stroke-bronze w-4/5">
					<g>
						<polyline points="12 105.92 12 204.03 228.26 204.03"/>
						<polyline points="493.05 114.07 493.05 12 118.78 12"/>
					</g>
				</svg>
			</div>
		</div>
	</section>

	<!-- Clients Section -->
	<section class="bg-light-gray py-16 md:py-24 overflow-hidden">
		<h2 class="text-dark-slate text-2xl md:text-2xl lg:text-3xl font-light italic tracking-wide text-center mb-12 md:mb-16">
			{t('home.clients.title')}
		</h2>

		<div class="clients-carousel" style="--duration: 30s;">
			<div class="clients-track">
				<img src="/assets/logos/logo_rs.png" alt="Red Sox" loading="lazy" />
				<img src="/assets/logos/logo_iberica.png" alt="La Ibérica" loading="lazy" />
				<img src="/assets/logos/logo_marlins.png" alt="Miami Marlins" loading="lazy" />
				<img src="/assets/logos/logo_giants.png" alt="Giants" loading="lazy" />
				<img src="/assets/logos/logo_angels.png" alt="Angels" loading="lazy" />
				<img src="/assets/logos/logo_detroit.png" alt="Detroit Tigers" loading="lazy" />
				<img src="/assets/logos/logo_diamond.png" alt="Diamond" loading="lazy" />
				<img src="/assets/logos/logo_guardians.png" alt="Guardians" loading="lazy" />
				<img src="/assets/logos/logo_alterra.png" alt="Alterra" loading="lazy" />
				<img src="/assets/logos/logo_cepm.png" alt="CEPM" loading="lazy" />
				<img src="/assets/logos/logo_manzanillo.png" alt="Manzanillo" loading="lazy" />
				<img src="/assets/logos/logo_megacentro.png" alt="Megacentro" loading="lazy" />
				<img src="/assets/logos/logo_ccn.png" alt="CCN" loading="lazy" />
				<img src="/assets/logos/logo_agora.png" alt="Ágora" loading="lazy" />

				<img src="/assets/logos/logo_rs.png" alt="Red Sox" loading="lazy" aria-hidden="true" />
				<img src="/assets/logos/logo_iberica.png" alt="La Ibérica" loading="lazy" aria-hidden="true" />
				<img src="/assets/logos/logo_marlins.png" alt="Miami Marlins" loading="lazy" aria-hidden="true" />
				<img src="/assets/logos/logo_giants.png" alt="Giants" loading="lazy" aria-hidden="true" />
				<img src="/assets/logos/logo_angels.png" alt="Angels" loading="lazy" aria-hidden="true" />
				<img src="/assets/logos/logo_detroit.png" alt="Detroit Tigers" loading="lazy" aria-hidden="true" />
				<img src="/assets/logos/logo_diamond.png" alt="Diamond" loading="lazy" aria-hidden="true" />
				<img src="/assets/logos/logo_guardians.png" alt="Guardians" loading="lazy" aria-hidden="true" />
				<img src="/assets/logos/logo_alterra.png" alt="Alterra" loading="lazy" aria-hidden="true" />
				<img src="/assets/logos/logo_cepm.png" alt="CEPM" loading="lazy" aria-hidden="true" />
				<img src="/assets/logos/logo_manzanillo.png" alt="Manzanillo" loading="lazy" aria-hidden="true" />
				<img src="/assets/logos/logo_megacentro.png" alt="Megacentro" loading="lazy" aria-hidden="true" />
				<img src="/assets/logos/logo_ccn.png" alt="CCN" loading="lazy" aria-hidden="true" />
				<img src="/assets/logos/logo_agora.png" alt="Ágora" loading="lazy" aria-hidden="true" />
			</div>
		</div>
	</section>

	<!-- PRACTICE AREAS Section -->
	<section class="pt-36 -mt-36 trigger">
		<div class="px-6 md:px-12 lg:px-20">
			<div class="mb-12 max-w-360 mx-auto items-center">
				<h2 class="text-dark-slate text-3xl md:text-4xl font-light tracking-wide">{t('home.areas.title')}</h2>
				<div class="w-20 h-0.75 bg-bronze mt-2"></div>
			</div>
		</div>

		<div class="areas-container flex w-vw overflow-x-hidden">
			{areasDePractica.map((area) => (
				<section class="areas-section py-8 ml-12 flex items-start justify-center">
					<PracticeAreaCard
						title={area.data.title}
						description={area.data.description}
						image={area.data.image}
						imageAlt={area.data.imageAlt}
						url={`${areaBasePath}${stripLangPrefix(area.id)}`}
						certificate={area.data.certificate}
					/>
				</section>
			))}
		</div>
	</section>

	<!-- PARTNERS Section -->
	<section class="bg-dark-slate pt-16 md:pt-24 px-6 md:px-12 lg:px-20">
		<div class="max-w-360 mx-auto">
			<div class="mb-12">
				<h2 class="text-white text-3xl md:text-4xl font-light tracking-wide">{t('home.socios.title')}</h2>
				<div class="w-20 h-0.75 bg-bronze mt-2"></div>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-2 gap-24 md:gap-12 xl:gap-36">
				<div class="max-w-120">
					<div class="relative overflow-hidden group">
						<img src="/assets/members/seibel.jpg" alt="John P. Seibel - Partner" class="aspect-square w-full object-cover object-top" />
						<div class="absolute inset-0 bg-bronze/70 flex items-end p-6 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
							<p class="text-white text-sm md:text-base font-light leading-relaxed">{t('home.socios.seibel-desc')}</p>
						</div>
					</div>
					<div class="flex items-center justify-between mt-6">
						<h3 class="text-white text-xl md:text-2xl font-light tracking-wide">JOHN P. SEIBEL</h3>
						<a href={`${teamBasePath}john-seibel`} class="border border-white text-white px-6 py-2 text-sm hover:bg-white hover:text-dark-slate transition-colors duration-300">
							{t('home.socios.ver-perfil')}
						</a>
					</div>
				</div>

				<div class="max-w-120 justify-self-end">
					<div class="relative overflow-hidden group">
						<img src="/assets/members/fernando.jpg" alt="Fernando P. Henríquez - Partner" class="aspect-square w-full object-cover max-h-160 object-top" />
						<div class="absolute inset-0 bg-bronze/70 flex items-end p-6 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
							<p class="text-white text-sm md:text-base font-light leading-relaxed">{t('home.socios.fernando-desc')}</p>
						</div>
					</div>
					<div class="flex items-center justify-between mt-6">
						<h3 class="text-white text-xl md:text-2xl font-light tracking-wide">FERNANDO P. HENRÍQUEZ</h3>
						<a href={`${teamBasePath}fernando-henriquez`} class="border border-white text-white px-6 py-2 text-sm hover:bg-white hover:text-dark-slate transition-colors duration-300">
							{t('home.socios.ver-perfil')}
						</a>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- OUR TEAM Section -->
	<section class="bg-dark-slate py-16 md:py-24 px-6 md:px-12 lg:px-20">
		<div class="max-w-360 mx-auto pt-16 md:pt-24">
			<div class="mb-12">
				<h2 class="text-white text-3xl md:text-4xl font-light tracking-wide">{t('home.team.title')}</h2>
				<div class="w-20 h-0.75 bg-bronze mt-2"></div>
			</div>
		</div>

		<div class="embla relative -mx-6 md:-mx-12 lg:-mx-20" id="teamCarousel">
			<div class="embla__viewport overflow-hidden">
				<div class="embla__container h-150 flex gap-0">
					{teamMembers.map((member) => (
						<TeamMemberCard
							name={member.data.name}
							position={member.data.position}
							phone={member.data.phone}
							email={member.data.email}
							image={member.data.image}
							imageAlt={member.data.imageAlt}
							link={`${teamBasePath}${stripLangPrefix(member.id)}`}
						/>
					))}
				</div>
			</div>

			<button class="team-prev absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-bronze text-white flex items-center justify-center hover:bg-opacity-80 transition-all duration-300 z-10 cursor-pointer" aria-label="Previous slide">
				<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg>
			</button>
			<button class="team-next absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-bronze text-white flex items-center justify-center hover:bg-opacity-80 transition-all duration-300 z-10 cursor-pointer" aria-label="Next slide">
				<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
			</button>
		</div>

		<div class="max-w-360 mx-auto">
			<div class="mt-12">
				<p class="text-white text-base md:text-xl font-light mt-4 max-w-3xl">{t('home.team.desc')}</p>
			</div>
		</div>
	</section>

	<script>
		const teamCarousel = document.getElementById('teamCarousel');
		if (teamCarousel && (window as any).EmblaCarousel) {
			const emblaApi = (window as any).EmblaCarousel(
				teamCarousel.querySelector('.embla__viewport'),
				{ loop: true, align: 'start', skipSnaps: false, dragFree: true, draggable: true }
			);

			const viewport = teamCarousel.querySelector('.embla__viewport') as HTMLElement;
			let wheelDelta = 0;
			const WHEEL_THRESHOLD = 50;

			if (viewport) {
				viewport.addEventListener('wheel', (e) => {
					const wheelEvt = e as WheelEvent;
					if (Math.abs(wheelEvt.deltaX) <= Math.abs(wheelEvt.deltaY)) return;
					e.preventDefault();
					wheelDelta += wheelEvt.deltaX;
					if (Math.abs(wheelDelta) >= WHEEL_THRESHOLD) {
						if (wheelDelta > 0) emblaApi.scrollNext();
						else emblaApi.scrollPrev();
						wheelDelta = 0;
					}
				}, { passive: false });
			}

			const prevBtn = teamCarousel.querySelector('.team-prev');
			const nextBtn = teamCarousel.querySelector('.team-next');
			if (prevBtn && nextBtn) {
				prevBtn.addEventListener('click', () => emblaApi.scrollPrev());
				nextBtn.addEventListener('click', () => emblaApi.scrollNext());
			}
		}
	</script>

	<!-- HIGH IMPACT Section -->
	<section class="bg-light-gray py-16 md:py-24 px-6 md:px-12 lg:px-20 alto-impacto-trigger">
		<div class="max-w-360 mx-auto">
			<div class="mb-12">
				<h2 class="text-dark-slate text-3xl md:text-4xl font-light tracking-widest">{t('home.impacto.title')}</h2>
				<div class="w-16 h-0.75 bg-bronze mb-8"></div>
			</div>

			<!-- MOBILE -->
			<div class="md:hidden">
				<div class="embla relative" id="altoImpactoCarousel">
					<div class="embla__viewport overflow-hidden">
						<div class="embla__container flex gap-0">
							{altoImpactoData.map((item) => (
								<ImpactCard title={item.title} description={item.description} image={item.image} imageAlt={item.imageAlt} />
							))}
						</div>
					</div>
					<button class="embla__prev absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 w-12 h-12 rounded-full bg-bronze text-white flex items-center justify-center hover:bg-opacity-80 transition-all duration-300 z-10 cursor-pointer" aria-label="Previous slide">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" /></svg>
					</button>
					<button class="embla__next absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 w-12 h-12 rounded-full bg-bronze text-white flex items-center justify-center hover:bg-opacity-80 transition-all duration-300 z-10 cursor-pointer" aria-label="Next slide">
						<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" /></svg>
					</button>
				</div>
			</div>

			<!-- DESKTOP -->
			<div class="hidden md:flex gap-12 lg:gap-16" id="altoImpactoTabs">
				<div class="w-2/5 flex flex-col gap-2 justify-center">
					{altoImpactoData.map((item, index) => (
						<button
							class:list={["impacto-tab text-left px-5 py-3 transition-colors duration-300 uppercase tracking-wider text-sm lg:text-base font-light cursor-pointer", index === 0 ? "bg-bronze text-white" : "bg-transparent text-dark-slate hover:bg-bronze/10"]}
							data-index={index}
						>{item.title}</button>
					))}
					<a href="#" class="hidden impacto-cta text-center px-5 py-3 mt-4 bg-bronze text-white uppercase tracking-wider text-sm lg:text-base font-light transition-colors duration-300 hover:bg-bronze/80">
						{t('home.impacto.ver-proyectos')}
					</a>
				</div>
				<div class="w-3/5 relative overflow-visible">
					{altoImpactoData.map((item, index) => (
						<div class:list={["impacto-card w-full overflow-hidden", index === 0 ? "relative" : "absolute inset-0"]} data-card-index={index}>
							<img src={item.image} alt={item.imageAlt} class="w-full h-64 lg:h-80 xl:h-96 object-cover" />
							<div class="bg-dark-slate p-6 lg:p-8">
								<div class="w-20 h-0.75 bg-bronze mb-4"></div>
								<p class="text-white text-sm lg:text-base font-light leading-relaxed">{item.description}</p>
							</div>
						</div>
					))}
				</div>
			</div>
		</div>
	</section>

	<script>
		const altoImpactoCarousel = document.getElementById('altoImpactoCarousel');
		if (altoImpactoCarousel && (window as any).EmblaCarousel) {
			const emblaApi = (window as any).EmblaCarousel(
				altoImpactoCarousel.querySelector('.embla__viewport'),
				{ loop: true, align: 'start', skipSnaps: false, dragFree: false }
			);
			const prevBtn = altoImpactoCarousel.querySelector('.embla__prev');
			const nextBtn = altoImpactoCarousel.querySelector('.embla__next');
			if (prevBtn && nextBtn) {
				prevBtn.addEventListener('click', () => emblaApi.scrollPrev());
				nextBtn.addEventListener('click', () => emblaApi.scrollNext());
			}
		}
	</script>

	<!-- RESPONSIBLE PRACTICE Section -->
	<section class="relative h-[80vh] w-full flex items-start">
		<img src="/assets/compromiso.avif" alt="Responsible Practice" class="absolute inset-0 w-full h-full object-cover object-bottom lg:object-left" />
		<div class="absolute inset-0 bg-black/20"></div>
		<div class="relative z-10 max-w-360 mx-auto px-6 md:px-12 lg:px-0 w-full flex justify-end py-12">
			<div class="max-w-xl">
				<h2 class="text-white text-base md:text-xl lg:text-4xl mb-8 font-light">{t('home.practica.title')}</h2>
				<a href={translatePath('/compromiso-social')} class="border-2 border-bronze text-bronze bg-white bg-opacity-90 px-8 py-3 hover:bg-bronze hover:text-white transition-colors duration-300 text-sm md:text-base tracking-wide uppercase">
					{t('home.practica.cta')}
				</a>
			</div>
		</div>
	</section>

	<!-- INSIGHTS Section -->
	<section class="bg-light-gray py-16 md:py-24 px-6 md:px-12 lg:px-20">
		<div class="max-w-360 mx-auto gap-12 items-center">
			<div class="space-y-4">
				<h2 class="text-dark-slate text-3xl md:text-4xl lg:text-5xl font-light tracking-wide">{t('home.insights.title')}</h2>
				<div class="w-20 h-0.75 bg-bronze mt-2"></div>
				<p class="text-dark-slate text-base md:text-lg lg:text-xl font-light leading-relaxed">{t('home.insights.desc')}</p>
				<button class="border-2 border-bronze text-bronze px-8 py-3 hover:bg-bronze hover:text-white transition-colors duration-300 text-sm md:text-base tracking-wide pointer-events-none opacity-30">
					{t('home.insights.newsletter')}
				</button>
			</div>
		</div>
	</section>
</Layout>

<style>
	.clients-carousel {
		width: 100%;
		mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
		-webkit-mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent);
	}
	.clients-track {
		display: flex;
		align-items: center;
		gap: 3rem;
		width: max-content;
		animation: scroll var(--duration, 30s) linear infinite;
	}
	.clients-track img {
		height: auto;
		width: 120px;
		object-fit: contain;
		flex-shrink: 0;
		filter: grayscale(100%);
		opacity: 0.7;
		transition: filter 0.3s, opacity 0.3s;
	}
	.clients-track img:hover {
		filter: grayscale(0%);
		opacity: 1;
	}
	@media (min-width: 768px) {
		.clients-track { gap: 4rem; }
		.clients-track img { height: 80px; }
	}
	@keyframes scroll {
		to { transform: translateX(-50%); }
	}
</style>

<script>
	import "../../scripts/areas_gsap.js";
	import "../../scripts/anims.js";
	import "../../scripts/altoImpacto_tabs.js";
</script>
