---
import Layout from '../../layouts/Layout.astro';
import AreaCard from '../../components/AreaCard.astro';
import { getCollection } from 'astro:content';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const langPrefix = `${lang}/`;

const areas = (await getCollection('areas')).filter((a) => a.id.startsWith(langPrefix));
const sortedAreas = areas.sort((a, b) => a.data.order - b.data.order);

const areaBasePath = lang === 'es' ? '/areas/' : '/en/areas/';
const stripLangPrefix = (id: string) => id.replace(langPrefix, '');
---

<Layout
	title={t('areas-page.title')}
	description={t('areas-page.description')}
>
	<section class="relative w-full h-72 md:h-96 overflow-hidden">
		<video class="absolute inset-0 w-full h-full object-cover" autoplay muted loop playsinline>
			<source src="/hero_video.mp4" type="video/mp4" />
		</video>
		<div class="absolute inset-0 bg-dark-slate/60"></div>
		<div class="absolute inset-0 flex items-end px-6 md:px-12 lg:px-20 pb-10 md:pb-14">
			<div class="max-w-360 mx-auto w-full">
				<h1 class="text-white text-4xl md:text-5xl lg:text-6xl font-light tracking-wide uppercase">
					{t('areas-page.heading')}
				</h1>
				<div class="w-24 h-1 bg-bronze mt-4"></div>
			</div>
		</div>
	</section>

	<section class="bg-light-gray py-16 md:py-24 px-6 md:px-12 lg:px-20">
		<div class="max-w-360 mx-auto">
			<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-x-8 gap-y-12">
				{sortedAreas.map((area) => (
					<AreaCard
						title={area.data.title}
						image={area.data.image}
						imageAlt={area.data.imageAlt}
						url={`${areaBasePath}${stripLangPrefix(area.id)}`}
						certificate={area.data.certificate}
					/>
				))}
			</div>
		</div>
	</section>
</Layout>
