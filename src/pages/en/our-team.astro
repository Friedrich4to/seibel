---
import Layout from '../../layouts/Layout.astro';
import SocioCard from '../../components/SocioCard.astro';
import TeamMemberCard from '../../components/TeamMemberCard.astro';
import { getCollection } from 'astro:content';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const langPrefix = `${lang}/`;

const allMembers = (await getCollection('team')).filter((m) => m.id.startsWith(langPrefix));
const socios = allMembers
	.filter((m) => m.data.role === 'socio')
	.sort((a, b) => a.data.order - b.data.order);
const teamMembers = allMembers
	.filter((m) => m.data.role !== 'socio')
	.sort((a, b) => a.data.order - b.data.order);

const teamBasePath = lang === 'es' ? '/team/' : '/en/team/';
const stripLangPrefix = (id: string) => id.replace(langPrefix, '');
---

<Layout
	title={t('team-page.title')}
	description={t('team-page.description')}
	navbarDarkMode={true}
>
	<section class="bg-light-gray py-16 md:py-24 px-6 md:px-12 lg:px-20">
		<div class="max-w-360 mx-auto">
			<div class="mb-12">
				<h2 class="text-dark-slate text-3xl md:text-4xl font-light tracking-wide">{t('team-page.socios')}</h2>
				<div class="w-20 h-0.75 bg-bronze mt-2"></div>
			</div>

			<div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-16">
				<SocioCard
					name={socios[0].data.name}
					phone={socios[0].data.phone}
					email={socios[0].data.email}
					image={socios[0].data.image}
					imageAlt={socios[0].data.imageAlt}
					link={`${teamBasePath}${stripLangPrefix(socios[0].id)}`}
				>
					<p>{t('team-page.seibel-desc')}</p>
				</SocioCard>

				<SocioCard
					name={socios[1].data.name}
					phone={socios[1].data.phone}
					email={socios[1].data.email}
					image={socios[1].data.image}
					imageAlt={socios[1].data.imageAlt}
					link={`${teamBasePath}${stripLangPrefix(socios[1].id)}`}
				>
					<p>{t('team-page.fernando-desc')}</p>
				</SocioCard>
			</div>
		</div>
	</section>

	<section class="bg-light-gray pb-16 md:pb-24 px-6 md:px-12 lg:px-20">
		<div class="max-w-360 mx-auto">
			<div class="mb-12">
				<h2 class="text-dark-slate text-3xl md:text-4xl font-light tracking-wide">{t('team-page.equipo')}</h2>
				<div class="w-20 h-0.75 bg-bronze mt-2"></div>
			</div>

			<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 md:gap-12">
				{teamMembers.map((member) => (
					<TeamMemberCard
						name={member.data.name}
						position={member.data.position}
						phone={member.data.phone}
						email={member.data.email}
						image={member.data.image}
						imageAlt={member.data.imageAlt}
						link={`${teamBasePath}${stripLangPrefix(member.id)}`}
						wrapperClass="group cursor-pointer"
					/>
				))}
			</div>
		</div>
	</section>
</Layout>
